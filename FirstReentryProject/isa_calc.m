function [T,P,rho,g,mu] = isa_calc(h)
%Valid for up to 80km
%Data from Franchini
%Input: Height in m



To = 288.1; %[K]

lda_t = -6.5e-3;

lda_e = 2.4481e-3;

lda_m = -4.33333e-3;

R = 287; 



g = 9.81*(6371e3/(6371e3+h))^2;

if (h<=11000) %Troposphere
    
    T = To + lda_t*h;

    P = 101325*(T/To)^(-9.81/(R*lda_t ));

    rho = 1.225*(T/To)^(-9.81/(R*lda_t)-1);

    mu = (1.458e-6*T^(1.5))/(T+110.4);
end



if (h>11000) && (h<=20000) %Stratosphere isotherm
        T11 = To + lda_t*11000;
    
    T = T11;
    
        P11 = 101325*(T/To)^(-9.81/(R*lda_t));
    
    P = P11 * exp(1)^((-9.81/(R*T))*(h-11000));
    
        rho11 = (1.225*(T/To)^(-9.81/(R*lda_t)-1));
    
    rho = rho11 * (exp(1))^((-9.81/(R*T))*(h-11000));
    
    mu = (1.458e-6*T^(1.5))/(T+110.4);
    
end



if (h>20000) && (h<=47000) %Stratosphere non-isotherm
    
        T11 = To + lda_t*11000; 
        
        T20 = T11;
    
    T = T20 + lda_e*(h-20000);
    
        P11 = 101325*((T11)/To)^(-9.81/(R*lda_t));
        
        P20 = P11 * exp(1)^((-9.81/(R*T20))*(20000-11000));
    
    P = P20 * (T/(T20))^(-9.81/(R*lda_e));
    
        rho11 = (1.225*((T11)/To)^(-9.81/(R*lda_t)-1));
    
        rho20 = rho11 * (exp(1))^((-9.81/(R*(T11)))*(20000-11000));
    
    rho = rho20 * (T/(T20))^(-9.81/(R*lda_e)-1);
    
    mu = (1.458e-6*T^(1.5))/(T+110.4);
    
end

if (h>47000) && (h<=53000) %Stratosphere isotherm 2.0 
    
        T11 = To + lda_t*11000; 
        
        T20 = T11;
        
        T47 = T20 + lda_e*(47000-20000);
        
    T = T47;  
    
        P11 = 101325*((T11)/To)^(-9.81/(R*lda_t));
        
        P20 = P11 * exp(1)^((-9.81/(R*T11))*(20000-11000));
        
        P47 = P20 * (T47/(T11))^(-9.81/(R*lda_e));
        
    P = P47 * exp(1)^((-9.81/(R*T))*(h-47000));
       
        rho11 = (1.225*((T11)/To)^(-9.81/(R*lda_t)-1));
    
        rho20 = rho11 * (exp(1))^((-9.81/(R*(T11)))*(20000-11000));
        
        rho47 = rho20 * (T47/(T11))^(-9.81/(R*lda_e)-1);
        
    rho = rho47 * (exp(1))^((-9.81/(R*T))*(h-47000));   
    
    mu = (1.458e-6*T^(1.5))/(T+110.4);
end


if (h>53000) && (h<=80000) %Mesosphere non-isotherm
    
        T11 = To + lda_t*11000; 
        
        T20 = T11;
        
        T47 = T20 + lda_e*(47000-20000);
        
        T53 = T47;
        
    T = T53 + lda_m*(h-53000);
        
        P11 = 101325*((T11)/To)^(-9.81/(R*lda_t));
        
        P20 = P11 * exp(1)^((-9.81/(R*T11))*(20000-11000));
        
        P47 = P20 * (T47/(T11))^(-9.81/(R*lda_e));
        
        P53 = P47 * exp(1)^((-9.81/(R*T53))*(53000-47000));
        
    P = P53 * (T/(T53))^(-9.81/(R*lda_m));
    
        rho11 = (1.225*((T11)/To)^(-9.81/(R*lda_t)-1));
    
        rho20 = rho11 * (exp(1))^((-9.81/(R*(T11)))*(20000-11000));
        
        rho47 = rho20 * (T47/(T11))^(-9.81/(R*lda_e)-1);
        
        rho53 = rho47 * (exp(1))^((-9.81/(R*T53))*(53000-47000));
        
    rho = rho53 * (T/(T53))^(-9.81/(R*lda_m)-1);
    
    mu = (1.458e-6*T^(1.5))/(T+110.4);
    
end


if (h>80000) %&& (h<=90000)
    
        T11 = To + lda_t*11000; 
        
        T20 = T11;
        
        T47 = T20 + lda_e*(47000-20000);
        
        T53 = T47;
        
        T80 = T53 + lda_m*(80000-53000);
        
    T = T80;
    
        P11 = 101325*((T11)/To)^(-9.81/(R*lda_t));
        
        P20 = P11 * exp(1)^((-9.81/(R*T11))*(20000-11000));
        
        P47 = P20 * (T47/(T11))^(-9.81/(R*lda_e));
        
        P53 = P47 * exp(1)^((-9.81/(R*T53))*(53000-47000));
        
        P80 = P53 * (T80/(T53))^(-9.81/(R*lda_m));
        
    P =  P80 * exp(1)^((-9.81/(R*T))*(h-80000));
    
        rho11 = (1.225*((T11)/To)^(-9.81/(R*lda_t)-1));
    
        rho20 = rho11 * (exp(1))^((-9.81/(R*(T11)))*(20000-11000));
        
        rho47 = rho20 * (T47/(T20))^(-9.81/(R*lda_e)-1);
        
        rho53 = rho47 * (exp(1))^((-9.81/(R*T53))*(53000-47000));
        
        rho80 = rho53 * (T80/(T53))^(-9.81/(R*lda_m)-1);
        
    rho = rho80 * (exp(1))^((-9.81/(R*T))*(h-80000));
        
    mu = (1.458e-6*T^(1.5))/(T+110.4);  
end

end